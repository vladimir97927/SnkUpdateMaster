# SnkUpdateMater.Core

Основной модуль работы с загрузкой и доставкой обновлений. 

## Скачивание и установка обновлений

Для проверки наличия обновлений и установки используется класс ``UpdateManager``, который зависит от интерфейсов:
- ``IUpdateSource`` - получение информации о доступном обновлении.
- ``ICurrentVersionManager`` - управление сведениями об установленной версии.
- ``IIntegrityVerifier`` - проверка хэш суммы загруженных файлов обновления.
- ``IInstaller`` - установка обновлений.
- ``IUpdateDownloader`` - загрузка обновлений.

С целью упрощения создания объекта ``UpdateManager`` используется класс ``UpdateManagerBuilder``. Добавление каждой зависимости осуществляется через методы с префиксом ``With``.

### Существующие реализации 

**FileVersionManager**

Сохранение версии приложения в файл. Добавляется вызовом метода ``WithFileCurrentVersionManager()``. При использовании в папке с приложением создается файл с именем `version`. Версия приложения хранится как строка формата `x.x.x`.

**ZipInstaller**

Установка ZIP архива с обновлениями. При использовании необходимо указать путь до папки, в которую будут установлены обновления (`appDir`). Добавляется вызовом метода `WithZipInstaller(string appDir)`. При использовании создает резервную копию приложения и помещает ее в папку `backup`. 
Восстановление из резервной копии происходит при ошибках распаковки ZIP архива.

**ShaIntegrityVerifier**

Проверка контрольной суммы загруженных обновлений алгоритмом SHA256. Добавляется вызовом метода `WithSha256IntegrityVerifier()`.

> Интерфейсы ``IUpdateSource`` и ``IUpdateDownloader`` реализованы в других модулях.

## Публикация обновлений

Для публикации обновлений используется класс `ReleaseManager`, который зависит от интерфейсов:
- ``IReleasePackager`` - упаковка обновления.
- ``IReleaseSource`` - загрузка обновлений в источник.
- ``IReleaseInfoSource`` - получение данных о загруженных обновлениях.

С целью упрощения создания объекта ``ReleaseManager`` используется класс ``ReleaseManagerBuilder``. Добавелние каждой зависимости осуществляется через методы с префиксом ``With``.

### Существующие реализации 

**ZipReleasePackager**

Упаковка файлов обновления в ZIP архив. Добавляется вызовом метода `WithZipPackager(IntegrityProviderType integrityProviderType = IntegrityProviderType.Sha256)`. `IntegrityProviderType` - алгоритм вычисления хэш суммы.

> Интерфейсы ``IReleaseSource`` и ``IReleaseInfoSource`` реализованы в других модулях.
