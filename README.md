# SnkUpdateMaster

[![WIP](https://img.shields.io/badge/Status-Work%20In%20Progress-orange)](https://github.com/vladimir97927/SnkUpdateMaster)
![platform: .NET](https://img.shields.io/badge/platform-.NET-informational)
![language: C#](https://img.shields.io/badge/language-C%23-blue)

> **‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ**: –ü—Ä–æ–µ–∫—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. API –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è.

–ü—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π.

## üåü –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –º–æ–¥—É–ª—å–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç–æ–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π. –ö–ª—é—á–µ–≤–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é —è–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –Ω–∞ –≤—Å–µ—Ö —ç—Ç–∞–ø–∞—Ö —Ä–∞–±–æ—Ç—ã: –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏–π, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø–æ–¥ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

**–ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**

1. –í—ã–±–æ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - HTTP/S-—Å–µ—Ä–≤–µ—Ä.‚ùå
   - FTP/SFTP-—Å–µ—Ä–≤–µ—Ä.‚úÖ
   - –†–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.‚úÖ
   - GitHub Releases.‚ùå
2. –í—ã–±–æ—Ä —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞
   - –ê—Ä—Ö–∏–≤—ã.‚úÖ
   - –ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã.‚ùå
   - –°–∫—Ä–∏–ø—Ç—ã.‚ùå
3. –ö–æ–Ω—Ç—Ä–æ–ª—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö. –í—ã–±–æ—Ä –∞–ª–≥–æ—Ä–∏—Ç–º–∞ —Ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

- **.NET SDK 8.0**
- **Docker** –∏ **Docker Compose** (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥–Ω—è—Ç–∏—è SQL Server –∏ FTP‚Äë—Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ `docker-compose.yml`)

### –°—Ä–µ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **.NET Runtime 8.0**  
  (–ª–∏–±–æ self‚Äëcontained —Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ —Ü–µ–ª–µ–≤—É—é –û–°)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ –º–∏–Ω–∏–º—É–º –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:
  - **FTP‚Äë—Å–µ—Ä–≤–µ—Ä** ‚Äî –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ;
  - **–∏–ª–∏ SQL Server** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è Microsoft SQL Server 2019+.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Sql Server + FTP)

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å —Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –ë–î –∏ —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –Ω–∞ FTP-—Å–µ—Ä–≤–µ—Ä–µ. –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `[app directory]\version`.
–¶–µ–ª–æ—Å—Ç–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ö—ç—à —Ñ—É–Ω–∫—Ü–∏–µ–π –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º sha256. –§–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å—Å—è –≤ zip –∞—Ä—Ö–∏–≤–µ.

```csharp
using SnkUpdateMaster.Core;
using SnkUpdateMaster.Ftp;
using SnkUpdateMaster.Ftp.Configuration;
using SnkUpdateMaster.SqlServer.Configuration;
using SnkUpdateMaster.SqlServer.Database;

var ftpClientFactory = new AsyncFtpClientFactory("localhost", "snk", "snk@12345", 2121);
var sqlConnectionFactory = new SqlConnectionFactory(ConnectionString);
var appDir = "app";
var downloadsDir = "downloads";

var updateManager = new UpdateManagerBuilder()
    .WithFileCurrentVersionManager()
    .WithSha256IntegrityVerifier()
    .WithZipInstaller(appDir)
    .WithSqlServerUpdateInfoProvider(sqlConnectionFactory)
    .WithFtpUpdateDownloader(ftpClientFactory, downloadsDir)
    .Build();

var progress = new Progress<double>();
var updated = await updateManager.CheckAndInstallUpdatesAsync(progress);
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ö–æ—Ä–Ω–µ–≤—ã–µ –∫–∞—Ç–∞–ª–æ–≥–∏:

```text
src/
  SnkUpdateMaster.Core            ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è 
  SnkUpdateMaster.Ftp             ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FTP
  SnkUpdateMaster.SqlServer       ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SQL Server
  SnkUpdateMaster.ReleasePublisher.CLI ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ —Ä–µ–ª–∏–∑–æ–≤ (**–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç** ‚ö†Ô∏è)
  Database                        ‚Äî Docker-–æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–µ–∫—Ç –ë–î
tests/                            ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
docker-compose.yml                ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (SQL + FTP)
````

## üìö –ú–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞
- [Core - –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.](docs/Core.md)
- [SqlServer - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.](docs/SqlServer.md)
- [SnkUpdateMasterDb - –ø—Ä–æ–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.](docs/SnkUpdateMasterDb.md)

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –Ω–∞ –±–∞–∑–µ Docker Compose.  
–§–∞–π–ª—ã `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ–ø–∏—Å–∞–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã. –¢–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã .NET, –ø–æ–¥–∫–ª—é—á–∞—è—Å—å –∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤–Ω—É—Ç—Ä–∏ Docker.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** / **Docker Desktop**;
- **Docker Compose v2**;
- **.NET SDK 8.0**.

### 1. –ó–∞–ø—É—Å–∫ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–ò–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:

```bash
docker compose up
```
### 2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–ö–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–æ–¥–Ω—è—Ç—ã –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
dotnet test SnkUpdateMaster.sln
```

–∏–ª–∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Å —Ç–µ—Å—Ç–∞–º–∏:

```bash
dotnet test tests/–ò–º—è–ü—Ä–æ–µ–∫—Ç–∞.Tests/–ò–º—è–ü—Ä–æ–µ–∫—Ç–∞.Tests.csproj
```

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –Ω–∞ —Ä–∞–±–æ—Ç—É —Å –ë–î –∏–∑ Docker.
–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–ø–æ—Ä—Ç, –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏ —Ç.–ø.) –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ `docker-compose.override.yml`.

### 3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ü–æ—Å–ª–µ –ø—Ä–æ–≥–æ–Ω–∫–∏ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å:

```bash
docker compose down
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ Docker

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–∞—è —Å—Ä–µ–¥–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, FTP-—Å–µ—Ä–≤–µ—Ä) –≤ —ç—Ç–æ–º —Å–ª—É—á–∞–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **.NET SDK 8.0**;
- –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω **SQL Server** –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã;
- –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω **FTP-—Å–µ—Ä–≤–µ—Ä** –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤.

**FTP‚Äë—Ç–µ—Å—Ç—ã** (`SnkUpdateMaster.Ftp.IntegrationTests`):

- `SNK_UPDATE_MASTER__FTP_HOST` ‚Äî —Ö–æ—Å—Ç FTP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `localhost`)
- `SNK_UPDATE_MASTER__FTP_PORT` ‚Äî –ø–æ—Ä—Ç FTP (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `2121`)
- `SNK_UPDATE_MASTER__FTP_USER` ‚Äî –ª–æ–≥–∏–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `snk`)
- `SNK_UPDATE_MASTER__FTP_PASS` ‚Äî –ø–∞—Ä–æ–ª—å (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `snk@12345`)

**SQL Server‚Äë—Ç–µ—Å—Ç—ã** (`SnkUpdateMaster.SqlServer.IntegrationTests`):

- `SNK_UPDATE_MASTER__SQL_CONN` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SQL Server  
  –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:
  `Server=localhost,1455;Database=SnkUpdateMasterDb;User Id=sa;Password=Snk@12345;Encrypt=False;TrustServerCertificate=True`








